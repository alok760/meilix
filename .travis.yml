language: generic
include:
- os: linux
  addons:
    apt:
      update: true
      sources:
      - ubuntu-toolchain-r-test
      packages:
      - debootstrap
      - genisoimage
      - p7zip-full
      - squashfs-tools
      - ubuntu-dev-tools
      - dpkg-dev
      - debhelper
      - fakeroot
      - devscripts
      - jq
sudo: required
dist: xenial
git:
  depth: 22
script:
- export LC_ALL=en_US.UTF-8
- export LANG=en_US.UTF-8
- export LANGUAGE=en_US.UTF-8
- chmod +x ./build.sh
- "./build.sh |& tee log.txt"
before_deploy:
- export image_name="`echo *.iso`"
- cat *.iso > "/home/travis/${image_name}"
- cp log.txt /home/travis/log.txt
notifications:
  slack: fossasia:3pMkQrSogvEMfnu9aJDW2ZYC
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: "hKuEmYnid5NBQaPqLDjHwjq3DGNNratLymFf8hvKnAWzBO2DNZrAO/+SMu80h5jaNTfCDGunvGZ/IpO/ZnM3vMU4N3BWuNqT/6q5LIRXHywbZJ9Lgv70r2IS6c3SSoPlVL1+V/InKD+x6OqY3MItKkDGN6Tq3iaC1WSiM4y4ajzZTlnJIDP3vdkNCigfrp6jqYYJR6sUWZqcjaKHWI761lPpq/ew7jDG7WwCRgE4RCgZMz0DwxHX0v+NoUr6ArEYg0JrUWFMTmNN/hG4/+9vEKe8o70gcSamiOX0zgx8Tx/e6w1uKUZC6Y62K1uWfTjGWtYGx2Sy+++TZder04TjFHB+FriVO4TXUkGBTLufmbk6a7mQPrC4fuCLkofHMJ0Lx37cZCsKYT9P706wU1RU3rg46n4bi8qgxBonjKIeQAcdqTx7m2MXS9K3aF6b/p0nhPFwyYxFKuLTeDkRHb0CdbbktK0+Itu6EGJdhjYj8Oz7oNntqHsLruXKDMPAajfkNCqSCI0swtycXPwL1YyKAaWpAPySNsOKBeAlpaIjsGy1nc9OfAtSqF2V8VWnfKmsfkDNHE9zh/PfZ8/j9O3e+hC5YNkAibz38W41vxFvgKkf5DTVKftGhRBiwjQ185YHmotkgdNJz9svfPUscVuukX5eRWbZeiLGaEnhNES5ASg="
  file_glob: true
  file:
  - "/home/travis/${image_name}"
  - "/home/travis/log.txt"
  on:
    all_branches: true
after_deploy:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh;
  fi
- cd scripts/mail-scripts && ./mail.py
after_failure:
- cd scripts/mail-scripts && ./mail-fail.py
env:
  global:
    secure: ZEIq6w9brECxhwKQ8SOu5tel7qBdI8Td0gdcMog8GMHqxaYEGBLE/BC0eUDUOpwHmVkOfAGsNGcUxRFpgouqW3FvMPDO6SMQnh60VXWkH1sQMK1LQfOsJuP6sHwBYp5jvPIBxmtpPHD2MuuMlK76TuR3ZlLAPSyKdUI7Q7Hf1y060k7301QgM6K51o6zfKgplN7IUAjue9msRBeiPuLUA7Y9reN1hRhQwudi4tSQl8Rc2YX5bP0jPb4JB1stmZh9/0M4G699k5oMIQXJo17GXnhn2xgxwzoLcuc828hC9nCVMqY10S6V128+hrb8nBrNVzhS25aDsiHgnpYV8OQVkB+wCihJvsO6A9VNxfaLrcPgyN7qWwIV1QNH7z/a2BFS+gMYAtzY82yFHL6jFSkuRujLDLv7PCB+mqyg+hEPkQ8aBjFJIyVKJg6tETqfD7soEe//HWSDpeSzJ0la0Tf6DJ5IQHeJ6llvG8V/TYXdFodSlTsIyvu/PB9hgF7bRVcuwEvRdsnA/E/UAO7OrWiib9/sSKsDZtVORCl/tIkh0erwd2JBAjMuTrUiETFK2MFSVGbuTFyK0jBLW3j6WcLPIbqXJMuY/5zqgjG0aodvAQtqu/iTkufGEhcTuofH1IV4e1y2o3t4d8jI4NsPjjn7md2t1l+GWVmZK+eBn7yI0gQ=
